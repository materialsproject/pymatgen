
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pymatgen.io.abinit.qjobs &#8212; pymatgen 2019.5.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/proBlue.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33990148-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2019.5.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../pymatgen.html" accesskey="U">pymatgen</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.io.abinit.qjobs</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Objects and methods to contact the resource manager to get info on the status of the job and useful statistics.</span>
<span class="sd">Note that this is not a wrapper for the C API but a collection of simple wrappers around the shell commands</span>
<span class="sd">provided by the resource manager  (qsub, qdel and qstat for PBS, sinfo, squeue... for Slurm).</span>
<span class="sd">The main goal indeed is providing a simplified common interface for different resource managers without</span>
<span class="sd">having to rely on external libraries.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">shlex</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">monty.collections</span> <span class="k">import</span> <span class="n">AttrDict</span>
<span class="kn">from</span> <span class="nn">monty.inspect</span> <span class="k">import</span> <span class="n">all_subclasses</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="JobStatus"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.JobStatus">[docs]</a><span class="k">class</span> <span class="nc">JobStatus</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object is an integer representing the status of a :class:`QueueJob`.</span>

<span class="sd">    Slurm API, see `man squeue`.</span>

<span class="sd">    JOB STATE CODES</span>
<span class="sd">       Jobs typically pass through several states in the course of their execution.  The typical  states  are</span>
<span class="sd">       PENDING, RUNNING, SUSPENDED, COMPLETING, and COMPLETED.  An explanation of each state follows.</span>

<span class="sd">    BF  BOOT_FAIL       Job  terminated  due  to launch failure, typically due to a hardware failure (e.g.</span>
<span class="sd">                        unable to boot the node or block and the job can not be requeued).</span>
<span class="sd">    CA  CANCELLED       Job was explicitly cancelled by the user or system administrator.</span>
<span class="sd">                        The job may or may not have been initiated.</span>
<span class="sd">    CD  COMPLETED       Job has terminated all processes on all nodes.</span>
<span class="sd">    CF  CONFIGURING     Job has been allocated resources, but are waiting for them to become ready for use (e.g. booting).</span>
<span class="sd">    CG  COMPLETING      Job is in the process of completing. Some processes on some  nodes may still be active.</span>
<span class="sd">    F   FAILED          Job terminated with non-zero exit code or other failure condition.</span>
<span class="sd">    NF  NODE_FAIL       Job terminated due to failure of one or more allocated nodes.</span>
<span class="sd">    PD  PENDING         Job is awaiting resource allocation.</span>
<span class="sd">    PR  PREEMPTED       Job terminated due to preemption.</span>
<span class="sd">    R   RUNNING         Job currently has an allocation.</span>
<span class="sd">    S   SUSPENDED       Job has an allocation, but execution has been suspended.</span>
<span class="sd">    TO  TIMEOUT         Job terminated upon reaching its time limit.</span>
<span class="sd">    SE SPECIAL_EXIT     The job was requeued in a special state. This state can be set by users, typically</span>
<span class="sd">                        in EpilogSlurmctld, if the job has terminated with a particular exit value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_STATUS_TABLE</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;RUNNING&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;RESIZING&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;SUSPENDED&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;COMPLETED&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;CANCELLED&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;TIMEOUT&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;PREEMPTED&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;NODEFAIL&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">, at </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_STATUS_TABLE</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>

<div class="viewcode-block" id="JobStatus.from_string"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.JobStatus.from_string">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a :class:`JobStatus` instance from its string representation.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_STATUS_TABLE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="n">s</span><span class="p">:</span> <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#raise ValueError(&quot;Wrong string %s&quot; % s)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Got unknown status: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QueueJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob">[docs]</a><span class="k">class</span> <span class="nc">QueueJob</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object provides methods to contact the resource manager to get info on the status</span>
<span class="sd">    of the job and useful statistics. This is an abstract class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Used to handle other resource managers.</span>
    <span class="n">S_UNKNOWN</span>   <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span>
    <span class="c1"># Slurm status</span>
    <span class="n">S_PENDING</span>   <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;PENDING&quot;</span><span class="p">)</span>
    <span class="n">S_RUNNING</span>   <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;RUNNING&quot;</span><span class="p">)</span>
    <span class="n">S_RESIZING</span>  <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;RESIZING&quot;</span><span class="p">)</span>
    <span class="n">S_SUSPENDED</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;SUSPENDED&quot;</span><span class="p">)</span>
    <span class="n">S_COMPLETED</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;COMPLETED&quot;</span><span class="p">)</span>
    <span class="n">S_CANCELLED</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;CANCELLED&quot;</span><span class="p">)</span>
    <span class="n">S_FAILED</span>    <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;FAILED&quot;</span><span class="p">)</span>
    <span class="n">S_TIMEOUT</span>   <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;TIMEOUT&quot;</span><span class="p">)</span>
    <span class="n">S_PREEMPTED</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;PREEMPTED&quot;</span><span class="p">)</span>
    <span class="n">S_NODEFAIL</span>  <span class="o">=</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;NODEFAIL&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="QueueJob.from_qtype_and_id"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.from_qtype_and_id">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_qtype_and_id</span><span class="p">(</span><span class="n">qtype</span><span class="p">,</span> <span class="n">queue_id</span><span class="p">,</span> <span class="n">qname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new istance of the appropriate subclass.</span>

<span class="sd">        Args:</span>
<span class="sd">            qtype: String specifying the Resource manager type.</span>
<span class="sd">            queue_id: Job identifier.</span>
<span class="sd">            qname: Name of the queue (optional).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">all_subclasses</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">QTYPE</span> <span class="o">==</span> <span class="n">qtype</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Cannot find QueueJob subclass registered for qtype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">qtype</span><span class="p">)</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">QueueJob</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">queue_id</span><span class="p">,</span> <span class="n">qname</span><span class="o">=</span><span class="n">qname</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_id</span><span class="p">,</span> <span class="n">qname</span><span class="o">=</span><span class="s2">&quot;UnknownQueue&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            queue_id: Job identifier.</span>
<span class="sd">            qname: Name of the queue (optional).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qname</span> <span class="o">=</span> <span class="n">queue_id</span><span class="p">,</span> <span class="n">qname</span>

        <span class="c1"># Initialize properties.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exitcode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">, qid=</span><span class="si">%s</span><span class="s2">, status=</span><span class="si">%s</span><span class="s2">, exit_code=</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exitcode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">__nonzero__</span> <span class="o">=</span> <span class="fm">__bool__</span>


    <span class="c1">#In many cases, we only need to know if job is terminated or not</span>
    <span class="c1">#def is_terminated()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_completed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_COMPLETED</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_RUNNING</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_FAILED</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_TIMEOUT</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_node_failures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_NODEFAIL</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unknown_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_UNKNOWN</span>

<div class="viewcode-block" id="QueueJob.set_status_exitcode_signal"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.set_status_exitcode_signal">[docs]</a>    <span class="k">def</span> <span class="nf">set_status_exitcode_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">exitcode</span><span class="p">,</span> <span class="n">signal</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exitcode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span> <span class="o">=</span> <span class="n">status</span><span class="p">,</span> <span class="n">exitcode</span><span class="p">,</span> <span class="n">signal</span></div>

<div class="viewcode-block" id="QueueJob.likely_code_error"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.likely_code_error">[docs]</a>    <span class="k">def</span> <span class="nf">likely_code_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See http://man7.org/linux/man-pages/man7/signal.7.html</span>

<span class="sd">        SIGHUP        1       Term    Hangup detected on controlling terminal or death of controlling process</span>
<span class="sd">        SIGINT        2       Term    Interrupt from keyboard</span>
<span class="sd">        SIGQUIT       3       Core    Quit from keyboard</span>
<span class="sd">        SIGILL        4       Core    Illegal Instruction</span>
<span class="sd">        SIGABRT       6       Core    Abort signal from abort(3)</span>
<span class="sd">        SIGFPE        8       Core    Floating point exception</span>
<span class="sd">        SIGKILL       9       Term    Kill signal</span>
<span class="sd">        SIGSEGV      11       Core    Invalid memory reference</span>
<span class="sd">        SIGPIPE      13       Term    Broken pipe: write to pipe with no readers</span>
<span class="sd">        SIGALRM      14       Term    Timer signal from alarm(2)</span>
<span class="sd">        SIGTERM      15       Term    Termination signal</span>
<span class="sd">        SIGUSR1   30,10,16    Term    User-defined signal 1</span>
<span class="sd">        SIGUSR2   31,12,17    Term    User-defined signal 2</span>
<span class="sd">        SIGCHLD   20,17,18    Ign     Child stopped or terminated</span>
<span class="sd">        SIGCONT   19,18,25    Cont    Continue if stopped</span>
<span class="sd">        SIGSTOP   17,19,23    Stop    Stop process</span>
<span class="sd">        SIGTSTP   18,20,24    Stop    Stop typed at terminal</span>
<span class="sd">        SIGTTIN   21,21,26    Stop    Terminal input for background process</span>
<span class="sd">        SIGTTOU   22,22,27    Stop    Terminal output for background process</span>

<span class="sd">        The signals SIGKILL and SIGSTOP cannot be caught, blocked, or ignored.</span>

<span class="sd">        Next the signals not in the POSIX.1-1990 standard but described in</span>
<span class="sd">        SUSv2 and POSIX.1-2001.</span>

<span class="sd">        Signal       Value     Action   Comment</span>
<span class="sd">        SIGBUS      10,7,10     Core    Bus error (bad memory access)</span>
<span class="sd">        SIGPOLL                 Term    Pollable event (Sys V).</span>
<span class="sd">                                        Synonym for SIGIO</span>
<span class="sd">        SIGPROF     27,27,29    Term    Profiling timer expired</span>
<span class="sd">        SIGSYS      12,31,12    Core    Bad argument to routine (SVr4)</span>
<span class="sd">        SIGTRAP        5        Core    Trace/breakpoint trap</span>
<span class="sd">        SIGURG      16,23,21    Ign     Urgent condition on socket (4.2BSD)</span>
<span class="sd">        SIGVTALRM   26,26,28    Term    Virtual alarm clock (4.2BSD)</span>
<span class="sd">        SIGXCPU     24,24,30    Core    CPU time limit exceeded (4.2BSD)</span>
<span class="sd">        SIGXFSZ     25,25,31    Core    File size limit exceeded (4.2BSD)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sig_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;SIGFPE&quot;</span><span class="p">,):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">received_signal</span><span class="p">(</span><span class="n">sig_name</span><span class="p">):</span> <span class="k">return</span> <span class="n">sig_name</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="QueueJob.received_signal"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.received_signal">[docs]</a>    <span class="k">def</span> <span class="nf">received_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Get the numeric value from signal and compare it with self.signal</span>
        <span class="kn">import</span> <span class="nn">signal</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sig_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># invalid sig_name or sig_name not available on this OS.</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="QueueJob.estimated_start_time"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.estimated_start_time">[docs]</a>    <span class="k">def</span> <span class="nf">estimated_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return date with estimated start time. None if it cannot be detected&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="QueueJob.get_info"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.get_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="QueueJob.get_nodes"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.get_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="QueueJob.get_stats"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.QueueJob.get_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="ShellJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.ShellJob">[docs]</a><span class="k">class</span> <span class="nc">ShellJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handler for Shell jobs.&quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;shell&quot;</span></div>


<div class="viewcode-block" id="SlurmJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.SlurmJob">[docs]</a><span class="k">class</span> <span class="nc">SlurmJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handler for Slurm jobs.&quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;slurm&quot;</span>

<div class="viewcode-block" id="SlurmJob.estimated_start_time"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.SlurmJob.estimated_start_time">[docs]</a>    <span class="k">def</span> <span class="nf">estimated_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#squeue  --start -j  116791</span>
        <span class="c1">#  JOBID PARTITION     NAME     USER  ST           START_TIME  NODES NODELIST(REASON)</span>
        <span class="c1"># 116791      defq gs6q2wop username  PD  2014-11-04T09:27:15     16 (QOSResourceLimit)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;squeue&quot;</span> <span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="s2">&quot;--job </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

        <span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span><span class="p">:</span>
                <span class="n">date_string</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">date_string</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_string</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SlurmJob.get_info"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.SlurmJob.get_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># See https://computing.llnl.gov/linux/slurm/sacct.html</span>
        <span class="c1">#If SLURM job ids are reset, some job numbers will</span>
        <span class="c1">#probably appear more than once refering to different jobs.</span>
        <span class="c1">#Without this option only the most recent jobs will be displayed.</span>

        <span class="c1">#state Displays the job status, or state.</span>
        <span class="c1">#Output can be RUNNING, RESIZING, SUSPENDED, COMPLETED, CANCELLED, FAILED, TIMEOUT,</span>
        <span class="c1">#PREEMPTED or NODE_FAIL. If more information is available on the job state than will fit</span>
        <span class="c1">#into the current field width (for example, the uid that CANCELLED a job) the state will be followed by a &quot;+&quot;.</span>

        <span class="c1">#gmatteo@master2:~</span>
        <span class="c1">#sacct --job 112367 --format=jobid,exitcode,state --allocations --parsable2</span>
        <span class="c1">#JobID|ExitCode|State</span>
        <span class="c1">#112367|0:0|RUNNING</span>
        <span class="c1">#scontrol show job 800197 --oneliner</span>

        <span class="c1"># For more info</span>
        <span class="c1">#login1$ scontrol show job 1676354</span>

        <span class="c1">#cmd = &quot;sacct --job %i --format=jobid,exitcode,state --allocations --parsable2&quot; % self.qid</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;scontrol show job </span><span class="si">%i</span><span class="s2"> --oneliner&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="c1">#print(line)</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="c1">#print(info)</span>

        <span class="n">qid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">JobId</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">qid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
        <span class="n">exitcode</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">ExitCode</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">JobState</span>

        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">exitcode</span><span class="p">:</span>
            <span class="n">exitcode</span><span class="p">,</span> <span class="n">signal</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">exitcode</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exitcode</span><span class="p">,</span> <span class="n">signal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exitcode</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_status_exitcode_signal</span><span class="p">(</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="n">exitcode</span><span class="p">,</span> <span class="n">signal</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">AttrDict</span><span class="p">(</span><span class="n">exitcode</span><span class="o">=</span><span class="n">exitcode</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span></div>

<div class="viewcode-block" id="SlurmJob.get_stats"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.SlurmJob.get_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;sacct --long --job </span><span class="si">%s</span><span class="s2"> --parsable2&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="c1">#print(&quot;lines0&quot;, lines[0])</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="PbsProJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.PbsProJob">[docs]</a><span class="k">class</span> <span class="nc">PbsProJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for PbsPro Jobs.</span>

<span class="sd">    See also https://github.com/plediii/pbs_util for a similar project.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;pbspro&quot;</span>
    <span class="c1"># Mapping PrbPro --&gt; Slurm. From `man qstat`</span>
    <span class="c1">#</span>
    <span class="c1"># S  The jobâ€™s state:</span>
    <span class="c1">#      B  Array job has at least one subjob running.</span>
    <span class="c1">#      E  Job is exiting after having run.</span>
    <span class="c1">#      F  Job is finished.</span>
    <span class="c1">#      H  Job is held.</span>
    <span class="c1">#      M  Job was moved to another server.</span>
    <span class="c1">#      Q  Job is queued.</span>
    <span class="c1">#      R  Job is running.</span>
    <span class="c1">#      S  Job is suspended.</span>
    <span class="c1">#      T  Job is being moved to new location.</span>
    <span class="c1">#      U  Cycle-harvesting job is suspended due to keyboard activity.</span>
    <span class="c1">#      W  Job is waiting for its submitter-assigned start time to be reached.</span>
    <span class="c1">#      X  Subjob has completed execution or has been deleted.</span>

    <span class="n">PBSSTAT_TO_SLURM</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">QueueJob</span><span class="o">.</span><span class="n">S_UNKNOWN</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">QueueJob</span><span class="o">.</span><span class="n">S_FAILED</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">QueueJob</span><span class="o">.</span><span class="n">S_COMPLETED</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">QueueJob</span><span class="o">.</span><span class="n">S_PENDING</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">QueueJob</span><span class="o">.</span><span class="n">S_RUNNING</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">QueueJob</span><span class="o">.</span><span class="n">S_SUSPENDED</span><span class="p">),</span>
    <span class="p">])</span>

<div class="viewcode-block" id="PbsProJob.estimated_start_time"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.PbsProJob.estimated_start_time">[docs]</a>    <span class="k">def</span> <span class="nf">estimated_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># qstat -T - Shows the estimated start time for all jobs in the queue.</span>
        <span class="c1">#                                                                           Est</span>
        <span class="c1">#                                                            Req&#39;d  Req&#39;d   Start</span>
        <span class="c1">#Job ID          Username Queue    Jobname    SessID NDS TSK Memory Time  S Time</span>
        <span class="c1">#--------------- -------- -------- ---------- ------ --- --- ------ ----- - -----</span>
        <span class="c1">#5669001.frontal username large    gs.Pt         --   96  96    --  03:00 Q    --</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;qstat </span><span class="si">%s</span><span class="s2"> -T&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sdate</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sdate</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># TODO One should convert to datetime</span>
        <span class="k">return</span> <span class="n">sdate</span></div>

<div class="viewcode-block" id="PbsProJob.get_info"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.PbsProJob.get_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># See also qstat -f</span>
        <span class="c1">#http://sc.tamu.edu/help/origins/batch.shtml#qstat</span>

        <span class="c1">#$&gt; qstat 5666289</span>
        <span class="c1">#frontal1:</span>
        <span class="c1">#                                                            Req&#39;d  Req&#39;d   Elap</span>
        <span class="c1">#Job ID          Username Queue    Jobname    SessID NDS TSK Memory Time  S Time</span>
        <span class="c1">#--------------- -------- -------- ---------- ------ --- --- ------ ----- - -----</span>
        <span class="c1">#5666289.frontal username main_ivy MorfeoTChk  57546   1   4    --  08:00 R 00:17</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;qstat </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># qstat: 5904257.frontal1 Job has finished, use -x or -H to obtain historical job information\n</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;qstat </span><span class="si">%d</span><span class="s2"> -x&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qid</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Here I don&#39;t know what&#39;s happeing but I get an output that differs from the one obtained in the terminal.</span>
        <span class="c1"># Job id            Name             User              Time Use S Queue</span>
        <span class="c1"># ----------------  ---------------- ----------------  -------- - -----</span>
        <span class="c1"># 5905011.frontal1  t0               gmatteo           01:37:08 F main_wes</span>
        <span class="c1">#print(out)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#print(line.split())</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PBSSTAT_TO_SLURM</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]]</span>

        <span class="c1"># Exit code and signal are not available.</span>
        <span class="c1"># Once could use tracejob....</span>
        <span class="c1"># See also http://docs.adaptivecomputing.com/torque/3-0-5/a.gprologueepilogue.php</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_status_exitcode_signal</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div></div>


<span class="c1">#################################</span>
<span class="c1"># Unsupported resource managers #</span>
<span class="c1">#################################</span>

<div class="viewcode-block" id="TorqueJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.TorqueJob">[docs]</a><span class="k">class</span> <span class="nc">TorqueJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Not supported&quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;torque&quot;</span></div>


<div class="viewcode-block" id="SgeJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.SgeJob">[docs]</a><span class="k">class</span> <span class="nc">SgeJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Not supported&quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;sge&quot;</span></div>


<div class="viewcode-block" id="MoabJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.MoabJob">[docs]</a><span class="k">class</span> <span class="nc">MoabJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Not supported&quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;moab&quot;</span></div>


<div class="viewcode-block" id="BlueGeneJob"><a class="viewcode-back" href="../../../../pymatgen.io.abinit.qjobs.html#pymatgen.io.abinit.qjobs.BlueGeneJob">[docs]</a><span class="k">class</span> <span class="nc">BlueGeneJob</span><span class="p">(</span><span class="n">QueueJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Not supported&quot;&quot;&quot;</span>
    <span class="n">QTYPE</span> <span class="o">=</span> <span class="s2">&quot;bluegene&quot;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2019.5.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../pymatgen.html" >pymatgen</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>