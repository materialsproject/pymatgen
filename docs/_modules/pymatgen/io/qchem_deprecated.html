
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pymatgen.io.qchem_deprecated &#8212; pymatgen 2019.5.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/proBlue.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33990148-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2019.5.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../pymatgen.html" accesskey="U">pymatgen</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.io.qchem_deprecated</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="c1"># Copyright (c) Pymatgen Development Team.</span>
<span class="c1"># Distributed under the terms of the MIT License.</span>

<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module implements input and output processing from QChem.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">Template</span>

<span class="kn">from</span> <span class="nn">monty.io</span> <span class="k">import</span> <span class="n">zopen</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.operations</span> <span class="k">import</span> <span class="n">SymmOp</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.units</span> <span class="k">import</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">FloatWithUnit</span>
<span class="kn">from</span> <span class="nn">monty.json</span> <span class="k">import</span> <span class="n">MSONable</span>
<span class="kn">from</span> <span class="nn">pymatgen.util.coord</span> <span class="k">import</span> <span class="n">get_angle</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Xiaohui Qu&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2013, The Electrolyte Genome Project&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Xiaohui Qu&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;xhqu1981@gmail.com&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;11/4/13&quot;</span>


<div class="viewcode-block" id="QcTask"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask">[docs]</a><span class="k">class</span> <span class="nc">QcTask</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object representing a QChem input file.</span>

<span class="sd">    Args:</span>
<span class="sd">        molecule: The input molecule. If it is None of string &quot;read&quot;,</span>
<span class="sd">            QChem will read geometry from checkpoint file. If it is a</span>
<span class="sd">            Molecule object, QcInput will convert it into Cartesian</span>
<span class="sd">            coordinates. Valid values: pymatgen Molecule object, &quot;read&quot;, None</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        charge (int): Charge of the molecule. If None, charge on molecule is</span>
<span class="sd">            used. Defaults to None.</span>
<span class="sd">        spin_multiplicity (int): Spin multiplicity of molecule. Defaults to</span>
<span class="sd">            None, which means that the spin multiplicity is set to 1 if the</span>
<span class="sd">            molecule has no unpaired electrons and to 2 if there are</span>
<span class="sd">            unpaired electrons.</span>
<span class="sd">        jobtype (str): The type the QChem job. &quot;SP&quot; for Single Point Energy,</span>
<span class="sd">            &quot;opt&quot; for geometry optimization, &quot;freq&quot; for</span>
<span class="sd">            vibrational frequency.</span>
<span class="sd">        title (str): Comments for the job. Defaults to None. Which means the</span>
<span class="sd">            $comment section will be discarded.</span>
<span class="sd">        exchange (str): The exchange methods of the theory. Examples including:</span>
<span class="sd">            &quot;B&quot; (in pure BLYP), &quot;PW91&quot;, &quot;PBE&quot;, &quot;TPSS&quot;.</span>
<span class="sd">            Defaults to &quot;HF&quot;.</span>
<span class="sd">            This parameter can also be common names of hybrid</span>
<span class="sd">            functionals, such as B3LYP, TPSSh, XYGJOS. In such cases,</span>
<span class="sd">            the correlation parameter should be left as None.</span>
<span class="sd">        correlation (str): The correlation level of the theory. Example</span>
<span class="sd">            including: &quot;MP2&quot;, &quot;RI-MP2&quot;, &quot;CCSD(T)&quot;, &quot;LYP&quot;, &quot;PBE&quot;, &quot;TPSS&quot;</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        basis_set (str/dict): The basis set.</span>
<span class="sd">            If it is a dict, each element can use different basis set.</span>
<span class="sd">        aux_basis_set (str/dict): Auxiliary basis set. For methods,</span>
<span class="sd">            like RI-MP2, XYG3, OXYJ-OS, auxiliary basis set is required.</span>
<span class="sd">            If it is a dict, each element can use different auxiliary</span>
<span class="sd">            basis set.</span>
<span class="sd">        ecp: Effective core potential (ECP) to be used.</span>
<span class="sd">            If it is a dict, each element can use different ECP.</span>
<span class="sd">        rem_params (dict): The parameters supposed to write in the $rem</span>
<span class="sd">            section. Dict of key/value pairs.</span>
<span class="sd">            Example: {&quot;scf_algorithm&quot;: &quot;diis_gdm&quot;, &quot;scf_max_cycles&quot;: 100}</span>
<span class="sd">        optional_params (dict): The parameter for keywords other than $rem</span>
<span class="sd">            section. Dict of key/value pairs.</span>
<span class="sd">            Example: {&quot;basis&quot;: {&quot;Li&quot;: &quot;cc-PVTZ&quot;, &quot;B&quot;: &quot;aug-cc-PVTZ&quot;,</span>
<span class="sd">            &quot;F&quot;: &quot;aug-cc-PVTZ&quot;} &quot;ecp&quot;: {&quot;Cd&quot;: &quot;srsc&quot;, &quot;Br&quot;: &quot;srlc&quot;}}</span>
<span class="sd">        ghost_atom (list): List of ghost atoms indices. Indices start from 0.</span>
<span class="sd">            The ghost atom will be represented in of the form of @element_symmbol</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optional_keywords_list</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;basis&quot;</span><span class="p">,</span> <span class="s2">&quot;basis2&quot;</span><span class="p">,</span> <span class="s2">&quot;ecp&quot;</span><span class="p">,</span> <span class="s2">&quot;empirical_dispersion&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;external_charges&quot;</span><span class="p">,</span> <span class="s2">&quot;force_field_params&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;intracule&quot;</span><span class="p">,</span> <span class="s2">&quot;isotopes&quot;</span><span class="p">,</span> <span class="s2">&quot;aux_basis&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;localized_diabatization&quot;</span><span class="p">,</span> <span class="s2">&quot;multipole_field&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;nbo&quot;</span><span class="p">,</span> <span class="s2">&quot;occupied&quot;</span><span class="p">,</span> <span class="s2">&quot;swap_occupied_virtual&quot;</span><span class="p">,</span> <span class="s2">&quot;opt&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;pcm&quot;</span><span class="p">,</span> <span class="s2">&quot;pcm_solvent&quot;</span><span class="p">,</span> <span class="s2">&quot;solvent&quot;</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">,</span> <span class="s2">&quot;qm_atoms&quot;</span><span class="p">,</span> <span class="s2">&quot;svp&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;svpirf&quot;</span><span class="p">,</span> <span class="s2">&quot;van_der_waals&quot;</span><span class="p">,</span> <span class="s2">&quot;xc_functional&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;cdft&quot;</span><span class="p">,</span> <span class="s2">&quot;efp_fragments&quot;</span><span class="p">,</span> <span class="s2">&quot;efp_params&quot;</span><span class="p">,</span> <span class="s2">&quot;alist&quot;</span><span class="p">,</span> <span class="s2">&quot;velocity&quot;</span><span class="p">}</span>
    <span class="n">alternative_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;job_type&quot;</span><span class="p">:</span> <span class="s2">&quot;jobtype&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;symmetry_ignore&quot;</span><span class="p">:</span> <span class="s2">&quot;sym_ignore&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;scf_max_cycles&quot;</span><span class="p">:</span> <span class="s2">&quot;max_scf_cycles&quot;</span><span class="p">}</span>
    <span class="n">alternative_values</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;optimization&quot;</span><span class="p">:</span> <span class="s2">&quot;opt&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">}</span>
    <span class="n">zmat_patt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\w+)*([\s,]+(\w+)[\s,]+(\w+))*[\-\.\s,\w]*$&#39;</span><span class="p">)</span>
    <span class="n">xyz_patt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\w+)[\s,]+([\d\.eE\-]+)[\s,]+([\d\.eE\-]+)[\s,]+&#39;</span>
                          <span class="sa">r</span><span class="s1">&#39;([\d\.eE\-]+)[\-\.\s,\w.]*$&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">jobtype</span><span class="o">=</span><span class="s1">&#39;SP&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s2">&quot;HF&quot;</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;6-31+G*&quot;</span><span class="p">,</span> <span class="n">aux_basis_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ecp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rem_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optional_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ghost_atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span> <span class="k">if</span> <span class="n">molecule</span> <span class="k">else</span> <span class="s2">&quot;read&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="n">spin_multiplicity</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">!=</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The only accept text value for mol is &quot;read&quot;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In case of type list, every element of mol must be a pymatgen Molecule&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For fragments molecule section input, charge and spin_multiplicity &quot;</span>
                                 <span class="s2">&quot;must be specificed&quot;</span><span class="p">)</span>
            <span class="n">total_charge</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">charge</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">])</span>
            <span class="n">total_unpaired_electron</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">total_charge</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The charge of the molecule doesn&#39;t equal to the sum of the fragment charges&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total_unpaired_electron</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Spin multiplicity of molecule and fragments doesn&#39;t match&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span> <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">charge</span>
            <span class="n">ghost_nelectrons</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">ghost_atoms</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ghost_atoms</span><span class="p">:</span>
                    <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">amt</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">ghost_nelectrons</span> <span class="o">+=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">amt</span>
            <span class="n">nelectrons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">nelectrons</span> <span class="o">-</span> <span class="n">ghost_nelectrons</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span>
            <span class="k">if</span> <span class="n">spin_multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="n">spin_multiplicity</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nelectrons</span> <span class="o">+</span> <span class="n">spin_multiplicity</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Charge of </span><span class="si">{}</span><span class="s2"> and spin multiplicity of </span><span class="si">{}</span><span class="s2"> &quot;</span>
                                     <span class="s2">&quot;is not possible for this molecule&quot;</span>
                                     <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nelectrons</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The molecule must be a pymatgen Molecule &quot;</span>
                             <span class="s2">&quot;object or read/None or list of pymatgen Molecule&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spin multiplicity must be set together&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ghost_atoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">set_charge_and_spin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_comment</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;rem&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exchange</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;hf&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;exchange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">available_jobtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sp&quot;</span><span class="p">,</span> <span class="s2">&quot;opt&quot;</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;force&quot;</span><span class="p">,</span> <span class="s2">&quot;rpath&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;nmr&quot;</span><span class="p">,</span> <span class="s2">&quot;bsse&quot;</span><span class="p">,</span> <span class="s2">&quot;eda&quot;</span><span class="p">,</span> <span class="s2">&quot;pes_scan&quot;</span><span class="p">,</span> <span class="s2">&quot;fsm&quot;</span><span class="p">,</span> <span class="s2">&quot;aimd&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;pimc&quot;</span><span class="p">,</span> <span class="s2">&quot;makeefp&quot;</span><span class="p">}</span>
        <span class="n">jt</span> <span class="o">=</span> <span class="n">jobtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">jt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">:</span>
            <span class="n">jt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">[</span><span class="n">jt</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">jt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_jobtypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Job type &quot;</span> <span class="o">+</span> <span class="n">jobtype</span> <span class="o">+</span> <span class="s2">&quot; is not supported yet&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">correlation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;correlation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correlation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rem_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rem_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">:</span>
                        <span class="c1"># noinspection PyTypeChecker</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The value in $rem can only be Integer &quot;</span>
                                     <span class="s2">&quot;or string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optional_params</span><span class="p">:</span>
            <span class="n">op_key</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">optional_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op_key</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_keywords_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">op_key</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_keywords_list</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">invalid_keys</span><span class="p">])</span> <span class="o">+</span>
                                 <span class="s1">&#39;is not a valid optional section&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optional_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_basis_set</span><span class="p">(</span><span class="n">basis_set</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">aux_basis_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aux_basis_required</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;6-31+g&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_auxiliary_basis_set</span><span class="p">(</span><span class="s2">&quot;rimp2-aug-cc-pvdz&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;6-311+g&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_auxiliary_basis_set</span><span class="p">(</span><span class="s2">&quot;rimp2-aug-cc-pvtz&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;aux_basis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Auxiliary basis set is missing&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_auxiliary_basis_set</span><span class="p">(</span><span class="n">aux_basis_set</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ecp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_ecp</span><span class="p">(</span><span class="n">ecp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span> <span class="o">=</span> <span class="n">ghost_atoms</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ghost_atoms must be a list of integers&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Each element of ghost atom list must an integer&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_aux_basis_required</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;exchange&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xygjos&#39;</span><span class="p">,</span> <span class="s1">&#39;xyg3&#39;</span><span class="p">,</span> <span class="s1">&#39;lxygjos&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;correlation&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;correlation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ri&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="QcTask.set_velocities"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_velocities">[docs]</a>    <span class="k">def</span> <span class="nf">set_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        :param velocities (au): list of list of atom velocities </span>
<span class="sd">        :return: </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocities</span></div>

<div class="viewcode-block" id="QcTask.set_basis_set"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_basis_set">[docs]</a>    <span class="k">def</span> <span class="nf">set_basis_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis_set</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">basis_set</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">basis_set</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gen&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;basis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis_set</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gen&quot;</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_set</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">bs</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span>
                <span class="n">mol_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span>
                                    <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
                <span class="n">basis_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_elements</span> <span class="o">-</span> <span class="n">basis_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The basis set for elements &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                         <span class="nb">list</span><span class="p">(</span><span class="n">mol_elements</span> <span class="o">-</span> <span class="n">basis_elements</span><span class="p">))</span> <span class="o">+</span>
                                     <span class="s2">&quot; is missing&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Basis set error: the molecule &quot;</span>
                                     <span class="s2">&quot;doesn&#39;t contain element &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basis_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis_set</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mixed&quot;</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">basis_set</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_set</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specific a basis set for every atom&quot;</span><span class="p">)</span>
            <span class="n">mol_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
            <span class="n">basis_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mol_elements</span> <span class="o">!=</span> <span class="n">basis_elements</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Elements in molecule and mixed basis set don&#39;t match&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t handle type &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">basis_set</span><span class="p">)))</span></div>

<div class="viewcode-block" id="QcTask.set_partial_hessian_atoms"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_partial_hessian_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">set_partial_hessian_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alist</span><span class="p">,</span> <span class="n">phess</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the parament alist must a list of atom indices&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;n_sol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">phess</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;phess&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;phess&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;freq&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;alist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alist</span></div>

<div class="viewcode-block" id="QcTask.set_basis2"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_basis2">[docs]</a>    <span class="k">def</span> <span class="nf">set_basis2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis2_basis_set</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis2_basis_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis2_basis_set</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">basis2_basis_set</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;basis2_gen&quot;</span><span class="p">,</span> <span class="s2">&quot;basis2_mixed&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;basis2&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis2_basis_set</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;basis2_gen&quot;</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis2_basis_set</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">bs</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span>
                <span class="n">mol_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span>
                                    <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
                <span class="n">basis_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_elements</span> <span class="o">-</span> <span class="n">basis_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The BASIS2 basis set for &quot;</span>
                                     <span class="s2">&quot;elements &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                         <span class="nb">list</span><span class="p">(</span><span class="n">mol_elements</span> <span class="o">-</span> <span class="n">basis_elements</span><span class="p">))</span> <span class="o">+</span>
                                     <span class="s2">&quot; is missing&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;BASIS2 basis set error: the &quot;</span>
                                     <span class="s2">&quot;molecule doesn&#39;t contain element &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basis_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis2_basis_set</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;basis2_mixed&quot;</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">basis2_basis_set</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis2_basis_set</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specific a BASIS2 basis set for every atom&quot;</span><span class="p">)</span>
            <span class="n">mol_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
            <span class="n">basis_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mol_elements</span> <span class="o">!=</span> <span class="n">basis_elements</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Elements in molecule and mixed basis set don&#39;t match&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t handle type &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">basis2_basis_set</span><span class="p">)))</span></div>

<div class="viewcode-block" id="QcTask.set_auxiliary_basis_set"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_auxiliary_basis_set">[docs]</a>    <span class="k">def</span> <span class="nf">set_auxiliary_basis_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aux_basis_set</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux_basis_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux_basis_set</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">aux_basis_set</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gen&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux_basis_set</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gen&quot;</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">aux_basis_set</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">bs</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span>
                <span class="n">mol_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span>
                                    <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
                <span class="n">basis_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_elements</span> <span class="o">-</span> <span class="n">basis_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The auxiliary basis set for &quot;</span>
                                     <span class="s2">&quot;elements &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                         <span class="nb">list</span><span class="p">(</span><span class="n">mol_elements</span> <span class="o">-</span> <span class="n">basis_elements</span><span class="p">))</span> <span class="o">+</span>
                                     <span class="s2">&quot; is missing&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Auxiliary asis set error: the &quot;</span>
                                     <span class="s2">&quot;molecule doesn&#39;t contain element &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basis_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux_basis_set</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mixed&quot;</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aux_basis_set</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux_basis_set</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specific a auxiliary basis set for every atom&quot;</span><span class="p">)</span>
            <span class="n">mol_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
            <span class="n">basis_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mol_elements</span> <span class="o">!=</span> <span class="n">basis_elements</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Elements in molecule and mixed basis set don&#39;t match&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t handle type &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">aux_basis_set</span><span class="p">)))</span></div>

<div class="viewcode-block" id="QcTask.set_ecp"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_ecp">[docs]</a>    <span class="k">def</span> <span class="nf">set_ecp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ecp</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ecp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;ecp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ecp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;ecp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gen&quot;</span>
            <span class="n">potentials</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ecp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">potentials</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ecp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">potentials</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span>
                <span class="n">mol_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span> <span class="k">for</span> <span class="n">site</span>
                                    <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
                <span class="n">ecp_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ecp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecp_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ECP error: the molecule &quot;</span>
                                     <span class="s2">&quot;doesn&#39;t contain element &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ecp_elements</span> <span class="o">-</span> <span class="n">mol_elements</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>

<div class="viewcode-block" id="QcTask.set_memory"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_memory">[docs]</a>    <span class="k">def</span> <span class="nf">set_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">static</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the maxium allowed memory.</span>

<span class="sd">        Args:</span>
<span class="sd">            total: The total memory. Integer. Unit: MBytes. If set to None,</span>
<span class="sd">                this parameter will be neglected.</span>
<span class="sd">            static: The static memory. Integer. Unit MBytes. If set to None,</span>
<span class="sd">                this parameterwill be neglected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">total</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;mem_total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
        <span class="k">if</span> <span class="n">static</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;mem_static&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static</span></div>

<div class="viewcode-block" id="QcTask.set_max_num_of_scratch_files"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_max_num_of_scratch_files">[docs]</a>    <span class="k">def</span> <span class="nf">set_max_num_of_scratch_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In QChem, the size of a single scratch is limited 2GB. By default,</span>
<span class="sd">        the max number of scratich is 16, which is cooresponding to 32GB</span>
<span class="sd">        scratch space. If you want to use more scratch disk space, you need</span>
<span class="sd">        to increase the number of scratch files:</span>

<span class="sd">        Args:</span>
<span class="sd">            num: The max number of the scratch files. (Integer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;max_sub_file_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span></div>

<div class="viewcode-block" id="QcTask.set_scf_algorithm_and_iterations"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_scf_algorithm_and_iterations">[docs]</a>    <span class="k">def</span> <span class="nf">set_scf_algorithm_and_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;diis&quot;</span><span class="p">,</span>
                                         <span class="n">iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set algorithm used for converging SCF and max number of SCF iterations.</span>

<span class="sd">        Args:</span>
<span class="sd">            algorithm: The algorithm used for converging SCF. (str)</span>
<span class="sd">            iterations: The max number of SCF iterations. (Integer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_algorithms</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;diis&quot;</span><span class="p">,</span> <span class="s2">&quot;dm&quot;</span><span class="p">,</span> <span class="s2">&quot;diis_dm&quot;</span><span class="p">,</span> <span class="s2">&quot;diis_gdm&quot;</span><span class="p">,</span> <span class="s2">&quot;gdm&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;rca&quot;</span><span class="p">,</span> <span class="s2">&quot;rca_diis&quot;</span><span class="p">,</span> <span class="s2">&quot;roothaan&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_algorithms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Algorithm &quot;</span> <span class="o">+</span> <span class="n">algorithm</span> <span class="o">+</span>
                             <span class="s2">&quot; is not available in QChem&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;scf_algorithm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;max_scf_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iterations</span></div>

<div class="viewcode-block" id="QcTask.set_scf_convergence_threshold"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_scf_convergence_threshold">[docs]</a>    <span class="k">def</span> <span class="nf">set_scf_convergence_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SCF is considered converged when the wavefunction error is less than</span>
<span class="sd">        10**(-exponent).</span>
<span class="sd">        In QChem, the default values are:</span>
<span class="sd">        5	For single point energy calculations.</span>
<span class="sd">        7	For geometry optimizations and vibrational analysis.</span>
<span class="sd">        8	For SSG calculations</span>

<span class="sd">        Args:</span>
<span class="sd">            exponent: The exponent of the threshold. (Integer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;scf_convergence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exponent</span></div>

<div class="viewcode-block" id="QcTask.set_integral_threshold"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_integral_threshold">[docs]</a>    <span class="k">def</span> <span class="nf">set_integral_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cutoff for neglect of two electron integrals. 10THRESH (THRESH &lt;= 14).</span>
<span class="sd">        In QChem, the default values are:</span>
<span class="sd">        8	For single point energies.</span>
<span class="sd">        10	For optimizations and frequency calculations.</span>
<span class="sd">        14	For coupled-cluster calculations.</span>

<span class="sd">        Args:</span>
<span class="sd">            thresh: The exponent of the threshold. (Integer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;thresh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresh</span></div>

<div class="viewcode-block" id="QcTask.set_dft_grid"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_dft_grid">[docs]</a>    <span class="k">def</span> <span class="nf">set_dft_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radical_points</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">angular_points</span><span class="o">=</span><span class="mi">302</span><span class="p">,</span>
                     <span class="n">grid_type</span><span class="o">=</span><span class="s2">&quot;Lebedev&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the grid for DFT numerical integrations.</span>

<span class="sd">        Args:</span>
<span class="sd">            radical_points: Radical points. (Integer)</span>
<span class="sd">            angular_points: Angular points. (Integer)</span>
<span class="sd">            grid_type: The type of of the grid. There are two standard grids:</span>
<span class="sd">                SG-1 and SG-0. The other two supported grids are &quot;Lebedev&quot; and</span>
<span class="sd">                &quot;Gauss-Legendre&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_lebedev_angular_points</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span>
                                            <span class="mi">170</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">434</span><span class="p">,</span>
                                            <span class="mi">590</span><span class="p">,</span> <span class="mi">770</span><span class="p">,</span> <span class="mi">974</span><span class="p">,</span> <span class="mi">1202</span><span class="p">,</span> <span class="mi">1454</span><span class="p">,</span> <span class="mi">1730</span><span class="p">,</span>
                                            <span class="mi">2030</span><span class="p">,</span> <span class="mi">2354</span><span class="p">,</span> <span class="mi">2702</span><span class="p">,</span> <span class="mi">3074</span><span class="p">,</span> <span class="mi">3470</span><span class="p">,</span> <span class="mi">3890</span><span class="p">,</span>
                                            <span class="mi">4334</span><span class="p">,</span> <span class="mi">4802</span><span class="p">,</span> <span class="mi">5294</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">grid_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sg-0&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;xc_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sg-1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;xc_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;lebedev&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angular_points</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_lebedev_angular_points</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">angular_points</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is not a valid &quot;</span>
                                 <span class="s2">&quot;Lebedev angular points number&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;xc_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{rp:06d}{ap:06d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">rp</span><span class="o">=</span><span class="n">radical_points</span><span class="p">,</span> <span class="n">ap</span><span class="o">=</span><span class="n">angular_points</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;gauss-legendre&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;xc_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-</span><span class="si">{rp:06d}{ap:06d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">rp</span><span class="o">=</span><span class="n">radical_points</span><span class="p">,</span> <span class="n">ap</span><span class="o">=</span><span class="n">angular_points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Grid type &quot;</span> <span class="o">+</span> <span class="n">grid_type</span> <span class="o">+</span> <span class="s2">&quot; is not supported &quot;</span>
                                                        <span class="s2">&quot;currently&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="QcTask.set_scf_initial_guess"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_scf_initial_guess">[docs]</a>    <span class="k">def</span> <span class="nf">set_scf_initial_guess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="s2">&quot;SAD&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set initial guess method to be used for SCF</span>

<span class="sd">        Args:</span>
<span class="sd">            guess: The initial guess method. (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">availabel_guesses</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;core&quot;</span><span class="p">,</span> <span class="s2">&quot;sad&quot;</span><span class="p">,</span> <span class="s2">&quot;gwh&quot;</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;fragmo&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">guess</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">availabel_guesses</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The guess method &quot;</span> <span class="o">+</span> <span class="n">guess</span> <span class="o">+</span> <span class="s2">&quot; is not supported &quot;</span>
                                                           <span class="s2">&quot;yet&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;scf_guess&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guess</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>

<div class="viewcode-block" id="QcTask.set_geom_max_iterations"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_geom_max_iterations">[docs]</a>    <span class="k">def</span> <span class="nf">set_geom_max_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the max iterations of geometry optimization.</span>

<span class="sd">        Args:</span>
<span class="sd">            iterations: the maximum iterations of geometry optimization.</span>
<span class="sd">            (Integer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;geom_opt_max_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iterations</span></div>

<div class="viewcode-block" id="QcTask.set_geom_opt_coords_type"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_geom_opt_coords_type">[docs]</a>    <span class="k">def</span> <span class="nf">set_geom_opt_coords_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords_type</span><span class="o">=</span><span class="s2">&quot;internal_switch&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the coordinates system used in geometry optimization.</span>
<span class="sd">        &quot;cartesian&quot;       --- always cartesian coordinates.</span>
<span class="sd">        &quot;internal&quot;        --- always internal coordinates.</span>
<span class="sd">        &quot;internal-switch&quot; --- try internal coordinates first, if fails, switch</span>
<span class="sd">        to cartesian coordinates.</span>
<span class="sd">        &quot;z-matrix&quot;        --- always z-matrix coordinates.</span>
<span class="sd">        &quot;z-matrix-switch&quot; --- try z-matrix first, if fails, switch to</span>
<span class="sd">        cartesian coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            coords_type: The type of the coordinates. (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coords_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cartesian&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;internal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;internal-switch&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                      <span class="s2">&quot;z-matrix&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;z-matrix-switch&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">coords_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">coords_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Coodinate system &quot;</span> <span class="o">+</span> <span class="n">coords_type</span> <span class="o">+</span> <span class="s2">&quot; is not &quot;</span>
                             <span class="s2">&quot;supported yet&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;geom_opt_coords&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">coords_map</span><span class="p">[</span><span class="n">coords_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span></div>

<div class="viewcode-block" id="QcTask.scale_geom_opt_threshold"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.scale_geom_opt_threshold">[docs]</a>    <span class="k">def</span> <span class="nf">scale_geom_opt_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">energy</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the convergence criteria of geometry optimization.</span>

<span class="sd">        Args:</span>
<span class="sd">            gradient: the scale factor for gradient criteria. If less than</span>
<span class="sd">                1.0, you are tightening the threshold. The base value is</span>
<span class="sd">                300  10E6</span>
<span class="sd">            displacement: the scale factor for atomic displacement. If less</span>
<span class="sd">                then 1.0, you are tightening the threshold. The base value is</span>
<span class="sd">                1200  10E6</span>
<span class="sd">            energy: the scale factor for energy change between successive</span>
<span class="sd">                iterations. If less than 1.0, you are tightening the</span>
<span class="sd">                threshold. The base value is 100  10E8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gradient</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">300</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">displacement</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1200</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">energy</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The geometry optimization convergence criteria &quot;</span>
                             <span class="s2">&quot;is too tight&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;geom_opt_tol_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gradient</span> <span class="o">*</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;geom_opt_tol_displacement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">displacement</span> <span class="o">*</span>
                                                              <span class="mi">1200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;geom_opt_tol_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span></div>

<div class="viewcode-block" id="QcTask.set_geom_opt_use_gdiis"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.set_geom_opt_use_gdiis">[docs]</a>    <span class="k">def</span> <span class="nf">set_geom_opt_use_gdiis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subspace_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use GDIIS algorithm in geometry optimization.</span>

<span class="sd">        Args:</span>
<span class="sd">            subspace_size: The size of the DIIS subsapce. None for default</span>
<span class="sd">                value. The default value is min(NDEG, NATOMS, 4) NDEG = number</span>
<span class="sd">                of moleculardegrees of freedom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subspace_size</span> <span class="o">=</span> <span class="n">subspace_size</span> <span class="k">if</span> <span class="n">subspace_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;geom_opt_max_diis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subspace_size</span></div>

<div class="viewcode-block" id="QcTask.disable_symmetry"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.disable_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">disable_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn the symmetry off.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;sym_ignore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;symmetry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="QcTask.use_cosmo"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.use_cosmo">[docs]</a>    <span class="k">def</span> <span class="nf">use_cosmo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dielectric_constant</span><span class="o">=</span><span class="mf">78.4</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the solvent model to COSMO.</span>

<span class="sd">        Args:</span>
<span class="sd">            dielectric_constant: the dielectric constant for the solvent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;solvent_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cosmo&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;solvent_dielectric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dielectric_constant</span></div>

<div class="viewcode-block" id="QcTask.use_pcm"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.use_pcm">[docs]</a>    <span class="k">def</span> <span class="nf">use_pcm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pcm_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solvent_key</span><span class="o">=</span><span class="s2">&quot;solvent&quot;</span><span class="p">,</span> <span class="n">solvent_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">radii_force_field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the solvent model to PCM. Default parameters are trying to comply to</span>
<span class="sd">        gaussian default value</span>

<span class="sd">        Args:</span>
<span class="sd">            pcm_params (dict): The parameters of &quot;$pcm&quot; section.</span>
<span class="sd">            solvent_key (str): for versions &lt; 4.2 the section name is &quot;pcm_solvent&quot;</span>
<span class="sd">            solvent_params (dict): The parameters of solvent_key section</span>
<span class="sd">            radii_force_field (str): The force fied used to set the solute</span>
<span class="sd">                radii. Default to UFF.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">solvent_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">default_pcm_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Theory&quot;</span><span class="p">:</span> <span class="s2">&quot;SSVPE&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;vdwScale&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
                              <span class="s2">&quot;Radii&quot;</span><span class="p">:</span> <span class="s2">&quot;UFF&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">solvent_params</span><span class="p">:</span>
            <span class="n">solvent_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Dielectric&quot;</span><span class="p">:</span> <span class="mf">78.3553</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">pcm_params</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pcm_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">][</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">default_pcm_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">][</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">solvent_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">solvent_key</span><span class="p">][</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;solvent_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pcm&quot;</span>
        <span class="k">if</span> <span class="n">radii_force_field</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">][</span><span class="s2">&quot;radii&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bondi&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;force_fied&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radii_force_field</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;molecule&quot;</span><span class="p">,</span> <span class="s2">&quot;rem&quot;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_keywords_list</span><span class="p">))</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="ow">or</span> <span class="n">sec</span> <span class="o">==</span> <span class="s2">&quot;molecule&quot;</span><span class="p">:</span>
                <span class="n">foramt_sec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;_format_&quot;</span> <span class="o">+</span> <span class="n">sec</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="n">sec</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">foramt_sec</span><span class="p">())</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$end&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_wrap_comment</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
        <span class="n">ml_section_start</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ml_section_start</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">title_section</span> <span class="o">=</span> <span class="n">comment</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">ml_section_start</span><span class="p">]</span>
            <span class="n">ml_section</span> <span class="o">=</span> <span class="n">comment</span><span class="p">[</span><span class="n">ml_section_start</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_section</span> <span class="o">=</span> <span class="n">comment</span>
            <span class="n">ml_section</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">wrapped_title_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">title_section</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">wrapped_ml_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ml_section</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">wrapped_ml_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wrapped_ml_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped_title_lines</span> <span class="o">+</span> <span class="n">wrapped_ml_lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_format_alist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;alist&quot;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_format_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:12.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">atom</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;velocity&quot;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_format_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">inner_format_mol</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">index_base</span><span class="p">):</span>
            <span class="n">mol_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">sites</span><span class="p">):</span>
                <span class="n">ghost</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span> \
                    <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="n">index_base</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">atom</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{ghost:s}{element:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ghost</span><span class="o">=</span><span class="n">ghost</span><span class="p">,</span>
                                                     <span class="n">element</span><span class="o">=</span><span class="n">site</span><span class="o">.</span><span class="n">species_string</span><span class="p">)</span>
                <span class="n">mol_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{atom:&lt;4}</span><span class="s2"> </span><span class="si">{x:&gt;17.8f}</span><span class="s2"> </span><span class="si">{y:&gt;17.8f}</span><span class="s2"> &quot;</span>
                                 <span class="s2">&quot;</span><span class="si">{z:&gt;17.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">site</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                                     <span class="n">y</span><span class="o">=</span><span class="n">site</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">site</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">mol_lines</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{charge:d}</span><span class="s2">  </span><span class="si">{multi:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charge</span><span class="o">=</span><span class="bp">self</span>
                         <span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; read&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">starting_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{charge:d}</span><span class="s2">  </span><span class="si">{multi:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">charge</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inner_format_mol</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">starting_index</span><span class="p">))</span>
                <span class="n">starting_index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inner_format_mol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_rem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rem_format_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;  {name:&gt;$name_width} = &quot;</span>
                                       <span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">name_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">name_width</span><span class="p">:</span>
                <span class="n">name_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rem</span> <span class="o">=</span> <span class="n">rem_format_template</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">name_width</span><span class="o">=</span><span class="n">name_width</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">priority_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;exchange&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
            <span class="n">priority_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;exchange&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
            <span class="n">priority_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span>
        <span class="n">priority_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;basis&quot;</span><span class="p">)</span>
        <span class="n">additional_keys</span> <span class="o">=</span> <span class="n">all_keys</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">priority_keys</span><span class="p">)</span>
        <span class="n">ordered_keys</span> <span class="o">=</span> <span class="n">priority_keys</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">additional_keys</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ordered_keys</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">basis</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{element:2s}</span><span class="s2"> </span><span class="si">{number:3d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bs</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_aux_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">basis</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{element:2s}</span><span class="s2"> </span><span class="si">{number:3d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bs</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_basis2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">basis</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;basis2&quot;</span><span class="p">]):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{element:2s}</span><span class="s2"> </span><span class="si">{number:3d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bs</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_ecp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ecp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">ecp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ecp&quot;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">ecp</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; ****&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_pcm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pcm_format_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;  {name:&gt;$name_width}   &quot;</span>
                                       <span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">name_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">name_width</span><span class="p">:</span>
                <span class="n">name_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rem</span> <span class="o">=</span> <span class="n">pcm_format_template</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">name_width</span><span class="o">=</span><span class="n">name_width</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;pcm&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_pcm_solvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;pcm_solvent&quot;</span><span class="p">):</span>
        <span class="n">pp_format_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;  {name:&gt;$name_width}   &quot;</span>
                                      <span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">name_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">name_width</span><span class="p">:</span>
                <span class="n">name_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rem</span> <span class="o">=</span> <span class="n">pp_format_template</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">name_width</span><span class="o">=</span><span class="n">name_width</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">priority_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dielectric&quot;</span><span class="p">,</span> <span class="s2">&quot;nonels&quot;</span><span class="p">,</span> <span class="s2">&quot;nsolventatoms&quot;</span><span class="p">,</span> <span class="s2">&quot;solventatom&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
                <span class="n">priority_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">additional_keys</span> <span class="o">=</span> <span class="n">all_keys</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">priority_keys</span><span class="p">)</span>
        <span class="n">ordered_keys</span> <span class="o">=</span> <span class="n">priority_keys</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">additional_keys</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ordered_keys</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;solventatom&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:&lt;4d}</span><span class="s2"> </span><span class="si">{:&lt;4d}</span><span class="s2"> </span><span class="si">{:&lt;4d}</span><span class="s2"> </span><span class="si">{:4.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">))</span>
                <span class="k">continue</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_format_solvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_pcm_solvent</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;solvent&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># lines is a list of all opt keywords</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opt_sub_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">sec</span> <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">])]</span>
        <span class="n">valid_sub_sections</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;CONSTRAINT&quot;</span><span class="p">,</span> <span class="s2">&quot;FIXED&quot;</span><span class="p">,</span> <span class="s2">&quot;CONNECT&quot;</span><span class="p">,</span> <span class="s2">&quot;DUMMY&quot;</span><span class="p">}</span>
        <span class="n">valid_fix_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;XY&quot;</span><span class="p">,</span> <span class="s2">&quot;XZ&quot;</span><span class="p">,</span> <span class="s2">&quot;YZ&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opt_sub_sections</span><span class="p">)</span> <span class="o">-</span> <span class="n">valid_sub_sections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">invalid_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">opt_sub_sections</span><span class="p">)</span> <span class="o">-</span> <span class="n">valid_sub_sections</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">invalid_keys</span><span class="p">])</span> <span class="o">+</span>
                             <span class="s1">&#39; is not a valid geometry optimization constraint&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt_sub_sec</span> <span class="ow">in</span> <span class="n">opt_sub_sections</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opt_sub_sec</span> <span class="o">==</span> <span class="s2">&quot;CONSTRAINT&quot;</span><span class="p">:</span>
                <span class="c1"># constraints</span>
                <span class="n">constraint_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CONSTRAINT&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">][</span><span class="s1">&#39;CONSTRAINT&#39;</span><span class="p">])):</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">][</span><span class="s1">&#39;CONSTRAINT&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;outp&#39;</span><span class="p">,</span> <span class="s1">&#39;tors&#39;</span><span class="p">,</span> <span class="s1">&#39;linc&#39;</span><span class="p">,</span> <span class="s1">&#39;linp&#39;</span><span class="p">]:</span>
                        <span class="n">constraint_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{vals[0]}</span><span class="s2"> </span><span class="si">{vals[1]}</span><span class="s2"> </span><span class="si">{vals[2]}</span><span class="s2"> </span><span class="si">{vals[3]}</span><span class="s2"> </span><span class="si">{vals[4]}</span><span class="s2"> </span><span class="si">{vals[5]}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;stre&#39;</span><span class="p">:</span>
                        <span class="n">constraint_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{vals[0]}</span><span class="s2"> </span><span class="si">{vals[1]}</span><span class="s2"> </span><span class="si">{vals[2]}</span><span class="s2"> </span><span class="si">{vals[3]}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bend&#39;</span><span class="p">:</span>
                        <span class="n">constraint_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{vals[0]}</span><span class="s2"> </span><span class="si">{vals[1]}</span><span class="s2"> </span><span class="si">{vals[2]}</span><span class="s2"> </span><span class="si">{vals[3]}</span><span class="s2"> </span><span class="si">{vals[4]}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">))</span>
                <span class="n">constraint_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ENDCONSTRAINT&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">constraint_lines</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opt_sub_sec</span> <span class="o">==</span> <span class="s2">&quot;FIXED&quot;</span><span class="p">:</span>
                <span class="n">fixed_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;FIXED&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">][</span><span class="s1">&#39;FIXED&#39;</span><span class="p">]):</span>
                    <span class="n">fix_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">][</span><span class="s1">&#39;FIXED&#39;</span><span class="p">][</span><span class="n">atom</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">fix_spec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_fix_spec</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a wrong keyword to fix atoms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fix_spec</span><span class="p">))</span>
                    <span class="n">fixed_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">fix_spec</span><span class="p">))</span>
                <span class="n">fixed_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ENDFIXED&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fixed_lines</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;$opt - </span><span class="si">{}</span><span class="s2"> is not supported yet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt_sub_sec</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span>

<div class="viewcode-block" id="QcTask.as_dict"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">mol_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="n">mol_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">mol_dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknow molecule type &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
             <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
             <span class="s2">&quot;molecule&quot;</span><span class="p">:</span> <span class="n">mol_dict</span><span class="p">,</span>
             <span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
             <span class="s2">&quot;spin_multiplicity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">,</span>
             <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ghost_atoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghost_atoms</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="QcTask.from_dict"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.from_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="p">[</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknow molecule type &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">])))</span>
        <span class="n">jobtype</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">exchange</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exchange&quot;</span><span class="p">,</span> <span class="s2">&quot;hf&quot;</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">correlation</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;correlation&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">basis_set</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span>
        <span class="n">aux_basis_set</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ecp</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ecp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ghost_atoms</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ghost_atoms&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">optional_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">op_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;rem&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">optional_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">op_keys</span><span class="p">:</span>
                <span class="n">optional_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">QcTask</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="n">mol</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;charge&quot;</span><span class="p">],</span>
                      <span class="n">spin_multiplicity</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;spin_multiplicity&quot;</span><span class="p">],</span>
                      <span class="n">jobtype</span><span class="o">=</span><span class="n">jobtype</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                      <span class="n">exchange</span><span class="o">=</span><span class="n">exchange</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="n">correlation</span><span class="p">,</span>
                      <span class="n">basis_set</span><span class="o">=</span><span class="n">basis_set</span><span class="p">,</span> <span class="n">aux_basis_set</span><span class="o">=</span><span class="n">aux_basis_set</span><span class="p">,</span>
                      <span class="n">ecp</span><span class="o">=</span><span class="n">ecp</span><span class="p">,</span> <span class="n">rem_params</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;rem&quot;</span><span class="p">],</span>
                      <span class="n">optional_params</span><span class="o">=</span><span class="n">optional_params</span><span class="p">,</span>
                      <span class="n">ghost_atoms</span><span class="o">=</span><span class="n">ghost_atoms</span><span class="p">,</span>
                      <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span></div>

<div class="viewcode-block" id="QcTask.write_file"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span></div>

<div class="viewcode-block" id="QcTask.from_file"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div>

<div class="viewcode-block" id="QcTask.from_string"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcTask.from_string">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates QcInput from a string.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: String representing a QChem input file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            QcInput object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">parse_section</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">section_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">section_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ghost_atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">parse_section</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;$end&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Format error, parsing failed&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parse_section</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">!=</span> <span class="s2">&quot;$end&quot;</span><span class="p">:</span>
                <span class="n">section_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parse_section</span><span class="p">:</span>
                <span class="n">parse_section</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">section_name</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">available_sections</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;molecule&quot;</span><span class="p">,</span> <span class="s2">&quot;rem&quot;</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">optional_keywords_list</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">section_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_sections</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized keyword &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span>
                                     <span class="s2">&quot; at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_num</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;duplicated keyword &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span>
                                     <span class="s2">&quot;at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_num</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">parse_section</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;$end&quot;</span><span class="p">:</span>
                <span class="n">func_name</span> <span class="o">=</span> <span class="s2">&quot;_parse_&quot;</span> <span class="o">+</span> <span class="n">section_name</span>
                <span class="k">if</span> <span class="n">func_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">QcTask</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">func_name</span> <span class="o">+</span> <span class="s2">&quot; is not implemented yet, &quot;</span>
                                    <span class="s2">&quot;please implement it&quot;</span><span class="p">)</span>
                <span class="n">parse_func</span> <span class="o">=</span> <span class="n">QcTask</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">QcTask</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">section_name</span> <span class="o">==</span> <span class="s2">&quot;molecule&quot;</span><span class="p">:</span>
                    <span class="n">mol</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="p">,</span> <span class="n">ghost_atoms</span> <span class="o">=</span> <span class="n">parse_func</span><span class="p">(</span><span class="n">section_text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">parse_func</span><span class="p">(</span><span class="n">section_text</span><span class="p">)</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
                <span class="n">parse_section</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">section_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">section_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">parse_section</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Format error. &quot;</span> <span class="o">+</span> <span class="n">section_name</span> <span class="o">+</span> <span class="s2">&quot; is not &quot;</span>
                             <span class="s2">&quot;terminated&quot;</span><span class="p">)</span>
        <span class="n">jobtype</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">exchange</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exchange&quot;</span><span class="p">,</span> <span class="s2">&quot;hf&quot;</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">correlation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;correlation&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">basis_set</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span>
        <span class="n">aux_basis_set</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ecp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ecp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">optional_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">op_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;rem&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">optional_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">op_keys</span><span class="p">:</span>
                <span class="n">optional_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">QcTask</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="n">mol</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">,</span>
                      <span class="n">spin_multiplicity</span><span class="o">=</span><span class="n">spin_multiplicity</span><span class="p">,</span>
                      <span class="n">jobtype</span><span class="o">=</span><span class="n">jobtype</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                      <span class="n">exchange</span><span class="o">=</span><span class="n">exchange</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="n">correlation</span><span class="p">,</span>
                      <span class="n">basis_set</span><span class="o">=</span><span class="n">basis_set</span><span class="p">,</span> <span class="n">aux_basis_set</span><span class="o">=</span><span class="n">aux_basis_set</span><span class="p">,</span>
                      <span class="n">ecp</span><span class="o">=</span><span class="n">ecp</span><span class="p">,</span> <span class="n">rem_params</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">],</span>
                      <span class="n">optional_params</span><span class="o">=</span><span class="n">optional_params</span><span class="p">,</span>
                      <span class="n">ghost_atoms</span><span class="o">=</span><span class="n">ghost_atoms</span><span class="p">,</span>
                      <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_comment</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_coords</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">coord_lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to parse coordinates. Copied from GaussianInput class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paras</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">var_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^([A-Za-z]+\S*)[\s=,]+([\d\-\.]+)$&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">coord_lines</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">var_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">paras</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Stores whether a Zmatrix format is detected. Once a zmatrix format</span>
        <span class="c1"># is detected, it is assumed for the remaining of the parsing.</span>
        <span class="n">zmode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">coord_lines</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">zmode</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">xyz_patt</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">xyz_patt</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">toks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[,\s]+&#39;</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">toks</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])))</span>
            <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">zmat_patt</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="n">zmode</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">toks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[,\s]+&#39;</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">toks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nn</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">toks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">toks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">nn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">nn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">paras</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paras</span><span class="p">[</span><span class="n">data</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])]))</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">coords1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">coords2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">bl</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">angle</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">op</span> <span class="o">=</span> <span class="n">SymmOp</span><span class="o">.</span><span class="n">from_origin_axis_angle</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span>
                                                           <span class="n">angle</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">coords2</span><span class="p">)</span>
                        <span class="n">vec</span> <span class="o">=</span> <span class="n">coord</span> <span class="o">-</span> <span class="n">coords1</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">vec</span> <span class="o">*</span> <span class="n">bl</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">+</span> <span class="n">coords1</span>
                        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">coords1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">coords2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">coords3</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">bl</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">angle</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">dih</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">v1</span> <span class="o">=</span> <span class="n">coords3</span> <span class="o">-</span> <span class="n">coords2</span>
                        <span class="n">v2</span> <span class="o">=</span> <span class="n">coords1</span> <span class="o">-</span> <span class="n">coords2</span>
                        <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
                        <span class="n">op</span> <span class="o">=</span> <span class="n">SymmOp</span><span class="o">.</span><span class="n">from_origin_axis_angle</span><span class="p">(</span>
                            <span class="n">coords1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">coords2</span><span class="p">)</span>
                        <span class="n">v1</span> <span class="o">=</span> <span class="n">coord</span> <span class="o">-</span> <span class="n">coords1</span>
                        <span class="n">v2</span> <span class="o">=</span> <span class="n">coords1</span> <span class="o">-</span> <span class="n">coords2</span>
                        <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
                        <span class="n">adj</span> <span class="o">=</span> <span class="n">get_angle</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
                        <span class="n">axis</span> <span class="o">=</span> <span class="n">coords1</span> <span class="o">-</span> <span class="n">coords2</span>
                        <span class="n">op</span> <span class="o">=</span> <span class="n">SymmOp</span><span class="o">.</span><span class="n">from_origin_axis_angle</span><span class="p">(</span>
                            <span class="n">coords1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dih</span> <span class="o">-</span> <span class="n">adj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
                        <span class="n">vec</span> <span class="o">=</span> <span class="n">coord</span> <span class="o">-</span> <span class="n">coords1</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">vec</span> <span class="o">*</span> <span class="n">bl</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">+</span> <span class="n">coords1</span>
                        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">parse_species</span><span class="p">(</span><span class="n">sp_str</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The species specification can take many forms. E.g.,</span>
<span class="sd">            simple integers representing atomic numbers (&quot;8&quot;),</span>
<span class="sd">            actual species string (&quot;C&quot;) or a labelled species (&quot;C1&quot;).</span>
<span class="sd">            Sometimes, the species string is also not properly capitalized,</span>
<span class="sd">            e.g, (&quot;c1&quot;). This method should take care of these known formats.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">sp_str</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">sp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">sp_str</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

        <span class="n">species</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_species</span><span class="p">,</span> <span class="n">species</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_molecule</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">parse_ghost_indices</span><span class="p">(</span><span class="n">coord_text_lines</span><span class="p">):</span>
            <span class="n">no_ghost_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">coord_text_lines</span><span class="p">]</span>
            <span class="n">ghosts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coord_text_lines</span><span class="p">):</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                    <span class="n">ghosts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ghosts</span><span class="p">,</span> <span class="n">no_ghost_text</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">contents</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">charge_multi_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*(?P&lt;charge&gt;&#39;</span>
                                          <span class="sa">r</span><span class="s1">&#39;[-+]?\d+)\s+(?P&lt;multi&gt;\d+)&#39;</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">charge_multi_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">))</span>
            <span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;multi&quot;</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">spin_multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Charge or spin multiplicity is not found&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">contents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--&quot;</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;--</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ghost_atoms</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">starting_index</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="n">frag_contents</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">charge_multi_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">frag_contents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">fragment_charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">))</span>
                        <span class="n">fragment_spin_multiplicity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;multi&quot;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;charge and spin multiplicity must be specified for each fragment&quot;</span><span class="p">)</span>
                    <span class="n">gh</span><span class="p">,</span> <span class="n">coord_lines</span> <span class="o">=</span> <span class="n">parse_ghost_indices</span><span class="p">(</span><span class="n">frag_contents</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">fragment</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_parse_coords</span><span class="p">(</span><span class="n">coord_lines</span><span class="p">)</span>
                    <span class="n">fragment</span><span class="o">.</span><span class="n">set_charge_and_spin</span><span class="p">(</span><span class="n">fragment_charge</span><span class="p">,</span> <span class="n">fragment_spin_multiplicity</span><span class="p">)</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fragment</span><span class="p">)</span>
                    <span class="n">ghost_atoms</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span><span class="o">+</span><span class="n">starting_index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gh</span><span class="p">])</span>
                    <span class="n">starting_index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fragment</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ghost_atoms</span><span class="p">,</span> <span class="n">coord_lines</span> <span class="o">=</span> <span class="n">parse_ghost_indices</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_parse_coords</span><span class="p">(</span><span class="n">coord_lines</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ghost_atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">set_charge_and_spin</span><span class="p">(</span><span class="n">charge</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="p">)</span>
            <span class="n">ghost_atoms</span> <span class="o">=</span> <span class="n">ghost_atoms</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ghost_atoms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">mol</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="p">,</span> <span class="n">ghost_atoms</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_rem</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">int_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+$&#39;</span><span class="p">)</span>
        <span class="n">float_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+\.\d+([eE][-+]?\d+)?$&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t parse $rem section, there should be &quot;</span>
                                 <span class="s2">&quot;at least two field: key and value!&quot;</span><span class="p">)</span>
            <span class="n">k1</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">:</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_values</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="s2">&quot;xc_grid&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">int_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">float_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_aux_basis</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Auxiliary basis set section format error&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">contents</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">element</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">!=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Atom order number doesn&#39;t match in $aux_basis section&quot;</span><span class="p">)</span>
                <span class="n">bs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                <span class="n">element</span><span class="p">,</span> <span class="n">basis</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">bs</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bs</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_basis2</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Auxiliary basis set section format error&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">contents</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">element</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">!=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Atom order number doesn&#39;t match in $aux_basis section&quot;</span><span class="p">)</span>
                <span class="n">bs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                <span class="n">element</span><span class="p">,</span> <span class="n">basis</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">bs</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bs</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_basis</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Basis set section format error&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">contents</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">element</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">!=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Atom order number doesn&#39;t match in $basis section&quot;</span><span class="p">)</span>
                <span class="n">bs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                <span class="n">element</span><span class="p">,</span> <span class="n">basis</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">bs</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bs</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_ecp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ECP section format error&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">contents</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">element</span><span class="p">,</span> <span class="n">ecp</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ecp</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_alist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="n">atom_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">atom_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">atom_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_velocity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">velocities</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">velocities</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_pcm</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">int_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+$&#39;</span><span class="p">)</span>
        <span class="n">float_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+\.\d+([eE][-+]?\d+)?$&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t parse $pcm section, there should be &quot;</span>
                                 <span class="s2">&quot;at least two field: key and value!&quot;</span><span class="p">)</span>
            <span class="n">k1</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">:</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_values</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">int_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">float_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_pcm_solvent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">int_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+$&#39;</span><span class="p">)</span>
        <span class="n">float_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+\.\d+([eE][-+]?\d+)?$&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t parse $pcm_solvent section, &quot;</span>
                                 <span class="s2">&quot;there should be at least two field: &quot;</span>
                                 <span class="s2">&quot;key and value!&quot;</span><span class="p">)</span>
            <span class="n">k1</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">:</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_keys</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_values</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">alternative_values</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="s2">&quot;solventatom&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>
                <span class="c1"># noinspection PyTypeChecker</span>
                <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">int_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">float_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_solvent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_parse_pcm_solvent</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_opt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="c1">#only parses opt constraints</span>
        <span class="n">opt_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">const_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">fixed_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">fixed_sec</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">valid_fix_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;XY&quot;</span><span class="p">,</span> <span class="s2">&quot;XZ&quot;</span><span class="p">,</span> <span class="s2">&quot;YZ&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ&quot;</span><span class="p">}</span>
        <span class="n">int_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+$&#39;</span><span class="p">)</span>
        <span class="n">float_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-+]?\d+\.\d+([eE][-+]?\d+)?$&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ENDCONSTRAINT&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">constraints</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">opt_dict</span><span class="p">[</span><span class="s2">&quot;CONSTRAINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">const_list</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ENDFIXED&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">fixed_sec</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">opt_dict</span><span class="p">[</span><span class="s2">&quot;FIXED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixed_dict</span>
            <span class="k">elif</span> <span class="n">constraints</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">int_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">float_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">const_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fixed_sec</span><span class="p">:</span>
                <span class="n">atom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">fix_spec</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fix_spec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_fix_spec</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a correct keyword to fix&quot;</span>
                                     <span class="s2">&quot;atoms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fix_spec</span><span class="p">))</span>
                <span class="n">fixed_dict</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">fix_spec</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;CONSTRAINT&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">constraints</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">const_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;FIXED&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">fixed_sec</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fixed_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Keyword </span><span class="si">{}</span><span class="s2"> in $opt section is not supported yet&quot;</span><span class="o">.</span>
                                 <span class="nb">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">opt_dict</span></div>


<div class="viewcode-block" id="QcInput"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcInput">[docs]</a><span class="k">class</span> <span class="nc">QcInput</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object representing a multiple step QChem input file.</span>

<span class="sd">    Args:</span>
<span class="sd">        jobs: The QChem jobs (List of QcInput object)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobs</span><span class="p">):</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="n">jobs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jobs</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">jobs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">QcTask</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;jobs must be a list QcInput object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="n">jobs</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">@@@</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">])</span>

<div class="viewcode-block" id="QcInput.write_file"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcInput.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span></div>

<div class="viewcode-block" id="QcInput.as_dict"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcInput.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
                <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">]}</span></div>

<div class="viewcode-block" id="QcInput.from_dict"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcInput.from_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">QcTask</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">QcInput</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span></div>

<div class="viewcode-block" id="QcInput.from_string"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcInput.from_string">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="n">qc_contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@@@&quot;</span><span class="p">)</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">QcTask</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">qc_contents</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">QcInput</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span></div>

<div class="viewcode-block" id="QcInput.from_file"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcInput.from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="QcOutput"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcOutput">[docs]</a><span class="k">class</span> <span class="nc">QcOutput</span><span class="p">:</span>

    <span class="n">kcal_per_mol_2_eV</span> <span class="o">=</span> <span class="mf">4.3363E-2</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">split_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\n\nRunning Job \d+ of \d+ \S+|&quot;</span> \
                        <span class="sa">r</span><span class="s2">&quot;[*]</span><span class="si">{61}</span><span class="s2">\nJob \d+ of \d+ \n[*]</span><span class="si">{61}</span><span class="s2">|&quot;</span> \
                        <span class="sa">r</span><span class="s2">&quot;\n.*time.*\nRunning Job \d+ of \d+ \S+&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_pattern</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="c1"># noinspection PyTypeChecker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_job</span><span class="p">,</span> <span class="n">chunks</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_pattern</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="c1"># noinspection PyTypeChecker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_job</span><span class="p">,</span> <span class="n">chunks</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">final_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;energies&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">final_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;molecules&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_expected_successful_pattern</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">qctask</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Convergence criterion met&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;correlation&quot;</span> <span class="ow">in</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;ccsd&quot;</span> <span class="ow">in</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;correlation&quot;</span><span class="p">]</span>\
                    <span class="ow">or</span> <span class="s2">&quot;qcisd&quot;</span> <span class="ow">in</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;correlation&quot;</span><span class="p">]:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CC.*converged&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;opt&quot;</span>\
                <span class="ow">or</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ts&quot;</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;OPTIMIZATION CONVERGED&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;freq&quot;</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;VIBRATIONAL ANALYSIS&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gradient&quot;</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Gradient of SCF Energy&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_job</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="n">scf_energy_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Total energy in the final basis set =&#39;</span>
                                        <span class="sa">r</span><span class="s1">&#39;\s+(?P&lt;energy&gt;-\d+\.\d+)&#39;</span><span class="p">)</span>
        <span class="n">corr_energy_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;name&gt;[A-Z\-\(\)0-9]+)\s+&#39;</span>
                                         <span class="sa">r</span><span class="s1">&#39;([tT]otal\s+)?[eE]nergy\s+=\s+&#39;</span>
                                         <span class="sa">r</span><span class="s1">&#39;(?P&lt;energy&gt;-\d+\.\d+)&#39;</span><span class="p">)</span>
        <span class="n">coord_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;\s*\d+\s+(?P&lt;element&gt;[A-Z][a-zH]*)\s+(?P&lt;x&gt;\-?\d+\.\d+)\s+&#39;</span>
            <span class="sa">r</span><span class="s1">&#39;(?P&lt;y&gt;\-?\d+\.\d+)\s+(?P&lt;z&gt;\-?\d+\.\d+)&#39;</span><span class="p">)</span>
        <span class="n">num_ele_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;There are\s+(?P&lt;alpha&gt;\d+)\s+alpha &#39;</span>
                                     <span class="sa">r</span><span class="s1">&#39;and\s+(?P&lt;beta&gt;\d+)\s+beta electrons&#39;</span><span class="p">)</span>
        <span class="n">total_charge_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Sum of atomic charges =&#39;</span>
                                          <span class="sa">r</span><span class="s1">&#39;\s+(?P&lt;charge&gt;\-?\d+\.\d+)&#39;</span><span class="p">)</span>
        <span class="n">scf_iter_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;\d+\s*(?P&lt;energy&gt;\-\d+\.\d+)\s+(?P&lt;diis_error&gt;\d+\.\d+E[-+]\d+)&#39;</span><span class="p">)</span>
        <span class="n">zpe_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;Zero point vibrational energy:\s+(?P&lt;zpe&gt;\d+\.\d+)\s+kcal/mol&#39;</span><span class="p">)</span>
        <span class="n">thermal_corr_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;(?P&lt;name&gt;\S.*\S):\s+(?P&lt;correction&gt;\d+\.\d+)\s+k?cal/mol&#39;</span><span class="p">)</span>
        <span class="n">detailed_charge_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;(Ground-State )?(?P&lt;method&gt;\w+)( Net)? Atomic Charges&#39;</span><span class="p">)</span>
        <span class="n">nbo_charge_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;(?P&lt;element&gt;[A-Z][a-z]{0,2})\s*(?P&lt;no&gt;\d+)\s+(?P&lt;charge&gt;\-?\d\.\d+)&#39;</span>
            <span class="sa">r</span><span class="s1">&#39;\s+(?P&lt;core&gt;\-?\d+\.\d+)\s+(?P&lt;valence&gt;\-?\d+\.\d+)&#39;</span>
            <span class="sa">r</span><span class="s1">&#39;\s+(?P&lt;rydberg&gt;\-?\d+\.\d+)\s+(?P&lt;total&gt;\-?\d+\.\d+)&#39;</span>
            <span class="sa">r</span><span class="s1">&#39;(\s+(?P&lt;spin&gt;\-?\d\.\d+))?&#39;</span><span class="p">)</span>
        <span class="n">nbo_wavefunction_type_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;This is an? (?P&lt;type&gt;\w+\-\w+) NBO calculation&#39;</span><span class="p">)</span>
        <span class="n">scr_dir_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Scratch files written to\s+(?P&lt;scr_dir&gt;[^\n]+)&quot;</span><span class="p">)</span>
        <span class="n">bsse_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;DE, kJ/mol\s+(?P&lt;raw_be&gt;\-?\d+\.?\d+([eE]\d+)?)\s+&#39;</span>
            <span class="sa">r</span><span class="s1">&#39;(?P&lt;corrected_be&gt;\-?\d+\.?\d+([eE]\d+)?)&#39;</span><span class="p">)</span>
        <span class="n">float_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\-?\d+\.?\d+([eE]\d+)?$&#39;</span><span class="p">)</span>

        <span class="n">error_defs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Convergence failure&#39;</span><span class="p">),</span> <span class="s2">&quot;Bad SCF convergence&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                <span class="sa">r</span><span class="s1">&#39;Coordinates do not transform within specified threshold&#39;</span><span class="p">),</span>
             <span class="s2">&quot;autoz error&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MAXIMUM OPTIMIZATION CYCLES REACHED&#39;</span><span class="p">),</span>
                <span class="s2">&quot;Geometry optimization failed&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+[Nn][Aa][Nn]\s+&#39;</span><span class="p">),</span> <span class="s2">&quot;NAN values&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;energy\s+=\s*(\*)+&#39;</span><span class="p">),</span> <span class="s2">&quot;Numerical disaster&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;NewFileMan::OpenFile\(\):\s+nopenfiles=\d+\s+&#39;</span>
                        <span class="sa">r</span><span class="s1">&#39;maxopenfiles=\d+s+errno=\d+&#39;</span><span class="p">),</span> <span class="s2">&quot;Open file error&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Application \d+ exit codes: 1[34]\d+&#39;</span><span class="p">),</span> <span class="s2">&quot;Exit Code 134&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Negative overlap matrix eigenvalue. Tighten integral &#39;</span>
                        <span class="sa">r</span><span class="s1">&#39;threshold \(REM_THRESH\)!&#39;</span><span class="p">),</span> <span class="s2">&quot;Negative Eigen&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Unable to allocate requested memory in mega_alloc&#39;</span><span class="p">),</span>
                <span class="s2">&quot;Insufficient static memory&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Application \d+ exit signals: Killed&#39;</span><span class="p">),</span>
                <span class="s2">&quot;Killed&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;UNABLE TO DETERMINE Lamda IN FormD&#39;</span><span class="p">),</span>
                <span class="s2">&quot;Lamda Determination Failed&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Job too small. Please specify .*CPSCF_NSEG&#39;</span><span class="p">),</span>
                <span class="s2">&quot;Freq Job Too Small&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Not enough total memory&#39;</span><span class="p">),</span>
                <span class="s2">&quot;Not Enough Total Memory&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Use of \$pcm_solvent section has been deprecated starting in Q-Chem&#39;</span><span class="p">),</span>
                <span class="s2">&quot;pcm_solvent deprecated&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scf_iters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">molecules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gradients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vib_freqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vib_modes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grad_comp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parse_input</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_coords</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_scf_iter</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_gradient</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_freq</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_modes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">qctask_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">qctask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">jobtype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">scr_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thermal_corr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">properly_terminated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">pop_method</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">parse_charge</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">nbo_available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">nbo_charge_header</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">parse_nbo_charge</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">charges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">scf_successful</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">opt_successful</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_alpha_homo</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_alpha_lumo</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_beta_homo</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parse_beta_lumo</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">current_alpha_homo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_alpha_lumo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_beta_homo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">homo_lumo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bsse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hiershfiled_pop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gen_scfman</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ep</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">error_defs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ep</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;NAN values&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parse_input</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qctask_lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">qctask</span> <span class="o">=</span> <span class="n">QcTask</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qctask_lines</span><span class="p">))</span>
                        <span class="n">jobtype</span> <span class="o">=</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;jobtype&quot;</span><span class="p">]</span>
                        <span class="n">parse_input</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">continue</span>
                <span class="n">qctask_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parse_coords</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">qctask</span> <span class="ow">and</span> <span class="n">qctask</span><span class="o">.</span><span class="n">ghost_atoms</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qctask</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">qctask</span><span class="o">.</span><span class="n">ghost_atoms</span><span class="p">:</span>
                                    <span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">qctask</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span>
                        <span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Molecule</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">parse_coords</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="s2">&quot;Atom&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">coord_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)),</span>
                              <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">))])</span>
                <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;element&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">parse_scf_iter</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;SCF time:  CPU&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_scf_iter</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="s1">&#39;Convergence criterion met&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">gen_scfman</span><span class="p">:</span>
                    <span class="n">scf_successful</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;GEN_SCFMAN&quot;</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="n">Energy</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">)</span>
                    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">energy</span><span class="p">]))</span>
                <span class="k">if</span> <span class="s1">&#39;Convergence criterion met&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">scf_successful</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">scf_iter_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">scf_iters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">)),</span>
                                          <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;diis_error&quot;</span><span class="p">))))</span>
            <span class="k">elif</span> <span class="n">parse_gradient</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;Max gradient component&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">gradients</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;max_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">grad_comp</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grad_comp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">gradients</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;gradients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">grad_comp</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Gradient section parsing failed&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="s2">&quot;RMS gradient&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">gradients</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;rms_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">parse_gradient</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">grad_comp</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">grad_comp</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grad_comp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">gradients</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;gradients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">grad_comp</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Gradient section parsing failed&quot;</span><span class="p">)</span>
                    <span class="n">grad_comp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grad_line_token</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">grad_crowd</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">grad_line_final</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="mi">12</span><span class="p">):</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">grad_line_token</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                            <span class="n">grad_crowd</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">grad_line_token</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">grad_line_token</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="n">grad_line_token</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                    <span class="k">if</span> <span class="n">grad_crowd</span><span class="p">:</span>
                        <span class="n">grad_line_final</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">grad_line_token</span><span class="p">)</span>
                    <span class="n">grad_comp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span>
                                      <span class="ow">in</span> <span class="n">grad_line_final</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]])</span>
            <span class="k">elif</span> <span class="n">parse_freq</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parse_modes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;TransDip&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">parse_modes</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vib_freqs</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">vib_modes</span><span class="p">)):</span>
                            <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span>
                                          <span class="s2">&quot;vib_mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">})</span>
                        <span class="n">vib_modes</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">continue</span>
                    <span class="n">dis_flat</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="n">dis_atom</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="nb">iter</span><span class="p">(</span><span class="n">dis_flat</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
                    <span class="n">vib_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dis_atom</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;STANDARD THERMODYNAMIC QUANTITIES&quot;</span> <span class="ow">in</span> <span class="n">line</span>\
                        <span class="ow">or</span> <span class="s2">&quot;Imaginary Frequencies&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_freq</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="s2">&quot;Frequency:&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">vib_freqs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">vib</span><span class="p">)</span> <span class="k">for</span> <span class="n">vib</span>
                                 <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
                <span class="k">elif</span> <span class="s2">&quot;X      Y      Z&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_modes</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">parse_charge</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">charges</span><span class="p">[</span><span class="n">pop_method</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pop_method</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">parse_charge</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span>\
                            <span class="s1">&#39;Atom&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">charges</span><span class="p">[</span><span class="n">pop_method</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">parse_nbo_charge</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">charges</span><span class="p">[</span><span class="n">pop_method</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">elif</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">20</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">pop_method</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">parse_nbo_charge</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">nbo_charge_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">charges</span><span class="p">[</span><span class="n">pop_method</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find NBO charges&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parse_alpha_homo</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;-- Occupied --&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="s2">&quot;-- Virtual --&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_alpha_homo</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">parse_alpha_lumo</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">float_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">current_alpha_homo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">parse_alpha_lumo</span><span class="p">:</span>
                <span class="n">current_alpha_lumo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">parse_alpha_lumo</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">parse_beta_homo</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;-- Occupied --&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="s2">&quot;-- Virtual --&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_beta_homo</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">parse_beta_lumo</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">float_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">current_beta_homo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">parse_beta_lumo</span><span class="p">:</span>
                <span class="n">current_beta_lumo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">parse_beta_lumo</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_alpha_homo</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_beta_homo</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">current_homo</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">current_alpha_homo</span><span class="p">,</span> <span class="n">current_beta_homo</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_homo</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_alpha_lumo</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_beta_lumo</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">current_lumo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">current_alpha_lumo</span><span class="p">,</span> <span class="n">current_beta_lumo</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_lumo</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">homo_lumo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Energy</span><span class="p">(</span><span class="n">current_homo</span><span class="p">,</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">),</span>
                                  <span class="n">Energy</span><span class="p">(</span><span class="n">current_lumo</span><span class="p">,</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">)])</span>
                <span class="n">current_alpha_homo</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">current_alpha_lumo</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">current_beta_homo</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">current_alpha_lumo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">homo_lumo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Energy</span><span class="p">(</span><span class="n">current_alpha_homo</span><span class="p">,</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">),</span>
                                  <span class="n">Energy</span><span class="p">(</span><span class="n">current_alpha_lumo</span><span class="p">,</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">)])</span>
                <span class="n">current_alpha_homo</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">current_alpha_lumo</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">current_beta_homo</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">spin_multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">num_ele_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">spin_multiplicity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">))</span> <span class="o">-</span> \
                            <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">total_charge_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">scr_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">scr_dir_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">scr_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;scr_dir&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">jobtype</span> <span class="ow">and</span> <span class="n">jobtype</span> <span class="o">==</span> <span class="s2">&quot;freq&quot;</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">zpe_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">zpe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;zpe&quot;</span><span class="p">))</span>
                        <span class="n">thermal_corr</span><span class="p">[</span><span class="s2">&quot;ZPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zpe</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">thermal_corr_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">thermal_corr</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)]</span> <span class="o">=</span> \
                            <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;correction&quot;</span><span class="p">))</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">bsse_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">raw_be</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;raw_be&quot;</span><span class="p">))</span>
                    <span class="n">corrected_be</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;corrected_be&quot;</span><span class="p">))</span>
                    <span class="n">bsse_fwu</span> <span class="o">=</span> <span class="n">FloatWithUnit</span><span class="p">(</span><span class="n">raw_be</span> <span class="o">-</span> <span class="n">corrected_be</span><span class="p">,</span> <span class="s2">&quot;kJ mol^-1&quot;</span><span class="p">)</span>
                    <span class="n">bsse</span> <span class="o">=</span> <span class="n">bsse_fwu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;eV atom^-1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">energy</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">scf_energy_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">gen_scfman</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;SCF&quot;</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="n">Energy</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">),</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">corr_energy_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;SCF&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">gen_scfman</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="n">Energy</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">),</span> <span class="s2">&quot;Ha&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">detailed_charge_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">pop_method</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">parse_charge</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">charges</span><span class="p">[</span><span class="n">pop_method</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">nbo_available</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nbo_charge_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="n">nbo_wavefunction_type_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">nbo_wavefunction_type</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                            <span class="n">nbo_charge_header_dict</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s2">&quot;closed-shell&quot;</span><span class="p">:</span> <span class="s2">&quot;Atom No    Charge        Core      &quot;</span>
                                                <span class="s2">&quot;Valence    Rydberg      Total&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;open-shell&quot;</span><span class="p">:</span> <span class="s2">&quot;Atom No    Charge        Core      &quot;</span>
                                              <span class="s2">&quot;Valence    Rydberg      Total      Density&quot;</span><span class="p">}</span>
                            <span class="n">nbo_charge_header</span> <span class="o">=</span> <span class="n">nbo_charge_header_dict</span><span class="p">[</span><span class="n">nbo_wavefunction_type</span><span class="p">]</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">nbo_charge_header</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">pop_method</span> <span class="o">=</span> <span class="s2">&quot;nbo&quot;</span>
                        <span class="n">parse_nbo_charge</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">charges</span><span class="p">[</span><span class="n">pop_method</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s2">&quot;GEN_SCFMAN: A general SCF calculation manager &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">gen_scfman</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="s2">&quot;N A T U R A L   B O N D   O R B I T A L   A N A L Y S I S&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">nbo_available</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">energy</span><span class="p">:</span>
                    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">energy</span><span class="p">]))</span>
                <span class="k">if</span> <span class="s2">&quot;User input:&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_input</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s2">&quot;Standard Nuclear Orientation (Angstroms)&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_coords</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s2">&quot;Performing Hirshfeld population analysis&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">hiershfiled_pop</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s2">&quot;Hirshfeld: atomic densities completed&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">hiershfiled_pop</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;Cycle       Energy         DIIS Error&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                        <span class="ow">or</span> <span class="s2">&quot;Cycle       Energy        RMS Gradient&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>\
                        <span class="ow">and</span> <span class="ow">not</span> <span class="n">hiershfiled_pop</span><span class="p">:</span>
                    <span class="n">parse_scf_iter</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">scf_iters</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">scf_successful</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="s2">&quot;Gradient of SCF Energy&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_gradient</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">gradients</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;gradients&quot;</span><span class="p">:</span> <span class="p">[]})</span>
                <span class="k">elif</span> <span class="s2">&quot;VIBRATIONAL ANALYSIS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_freq</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s2">&quot;Alpha MOs&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_alpha_homo</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">parse_alpha_lumo</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="s2">&quot;Beta MOs&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parse_beta_homo</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">parse_beta_lumo</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="s2">&quot;Thank you very much for using Q-Chem.&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">properly_terminated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s2">&quot;OPTIMIZATION CONVERGED&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">opt_successful</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Molecular charge is not found&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">spin_multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Molecular spin multipilicity is not found&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">qctask</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">qctask</span><span class="o">.</span><span class="n">ghost_atoms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">set_charge_and_spin</span><span class="p">(</span><span class="n">charge</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">thermal_corr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">thermal_corr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;Entropy&quot;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">*=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">kcal_per_mol_2_eV</span> <span class="o">*</span> <span class="mf">1.0E-3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">*=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">kcal_per_mol_2_eV</span>
            <span class="n">thermal_corr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">solvent_method</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
        <span class="k">if</span> <span class="n">qctask</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;solvent_method&quot;</span> <span class="ow">in</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">]:</span>
                <span class="n">solvent_method</span> <span class="o">=</span> <span class="n">qctask</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rem&quot;</span><span class="p">][</span><span class="s2">&quot;solvent_method&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;No input text&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">scf_successful</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Bad SCF convergence&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Bad SCF convergence&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">jobtype</span> <span class="o">==</span> <span class="s1">&#39;opt&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">opt_successful</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;Geometry optimization failed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Geometry optimization failed&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_expected_successful_pattern</span><span class="p">(</span><span class="n">qctask</span><span class="p">):</span>
                <span class="n">success_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">success_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find text to indicate success&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;jobtype&quot;</span><span class="p">:</span> <span class="n">jobtype</span><span class="p">,</span>
            <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="n">energies</span><span class="p">,</span>
            <span class="s2">&quot;HOMO/LUMOs&quot;</span><span class="p">:</span> <span class="n">homo_lumo</span><span class="p">,</span>
            <span class="s2">&quot;bsse&quot;</span><span class="p">:</span> <span class="n">bsse</span><span class="p">,</span>
            <span class="s1">&#39;charges&#39;</span><span class="p">:</span> <span class="n">charges</span><span class="p">,</span>
            <span class="s2">&quot;corrections&quot;</span><span class="p">:</span> <span class="n">thermal_corr</span><span class="p">,</span>
            <span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="n">molecules</span><span class="p">,</span>
            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">errors</span><span class="p">,</span>
            <span class="s2">&quot;has_error&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">freqs</span><span class="p">,</span>
            <span class="s2">&quot;gradients&quot;</span><span class="p">:</span> <span class="n">gradients</span><span class="p">,</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">qctask</span><span class="p">,</span>
            <span class="s2">&quot;gracefully_terminated&quot;</span><span class="p">:</span> <span class="n">properly_terminated</span><span class="p">,</span>
            <span class="s2">&quot;scf_iteration_energies&quot;</span><span class="p">:</span> <span class="n">scf_iters</span><span class="p">,</span>
            <span class="s2">&quot;solvent_method&quot;</span><span class="p">:</span> <span class="n">solvent_method</span><span class="p">,</span>
            <span class="s2">&quot;scratch_dir&quot;</span><span class="p">:</span> <span class="n">scr_dir</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="QcNucVeloc"><a class="viewcode-back" href="../../../pymatgen.io.qchem_deprecated.html#pymatgen.io.qchem_deprecated.QcNucVeloc">[docs]</a><span class="k">class</span> <span class="nc">QcNucVeloc</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class to QChem AMID NucVeloc file.</span>
<span class="sd">    </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            filename (str): Filename to parse</span>
<span class="sd">        </span>
<span class="sd">        .. attribute:: time_steps (fs)</span>
<span class="sd">            The AIMD time stamp for each frame</span>
<span class="sd">        </span>
<span class="sd">        .. attribute:: velocities (a.u.)</span>
<span class="sd">            The atom velocities for each frame. Format:</span>
<span class="sd">            [[[x, y, z]</span>
<span class="sd">              [x, y, z]</span>
<span class="sd">              ... ]   ## frame 1</span>
<span class="sd">             ...</span>
<span class="sd">             [[x, y, z]</span>
<span class="sd">              [x, y, z]</span>
<span class="sd">              ... ]   ## frame N</span>
<span class="sd">            ]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">step_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nuc_veloc_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="c1"># unit in au</span>
            <span class="n">veloc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="nb">iter</span><span class="p">(</span><span class="n">nuc_veloc_tokens</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">veloc</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2019.5.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../pymatgen.html" >pymatgen</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>