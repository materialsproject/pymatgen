# coding: utf-8
# Copyright (c) Pymatgen Development Team.
# Distributed under the terms of the MIT License.

import os
from pymatgen.util.testing import PymatgenTest

from pymatgen.io.atat import Mcsqs

test_dir = os.path.join(os.path.dirname(__file__), "..", "..", "..",
                        'test_files', "atat")

class McsqsTest(PymatgenTest):

    def test_mcsqs_import(self):

        test_string = """1.000000 0.000000 0.000000
0.000000 1.000000 0.000000
0.000000 0.000000 1.000000
0.000000 -1.000000 -2.000000
2.000000 -1.000000 0.000000
-1.000000 -1.000000 1.000000
0.000000 -2.000000 -1.000000 Mn
1.000000 -2.000000 -1.000000 Mn
0.000000 -1.000000 -1.000000 Mn
-0.000000 -2.000000 0.000000 Mn
1.000000 -2.000000 0.000000 Mn
0.000000 -1.000000 0.000000 Mn
1.000000 -1.000000 0.000000 Fe
1.000000 -3.000000 -1.000000 Mn
0.500000 -1.500000 -0.500000 Sr
1.500000 -1.500000 -0.500000 Ca
-0.500000 -1.500000 0.500000 Ca
0.500000 -1.500000 0.500000 Ca
1.500000 -2.500000 -1.500000 Ca
0.500000 -1.500000 -1.500000 Sr
0.500000 -2.500000 -0.500000 Sr
-0.500000 -1.500000 -0.500000 Ca
0.000000 -1.500000 -1.000000 O
1.000000 -1.500000 -1.000000 O
1.000000 -2.500000 0.000000 O
-0.000000 -1.500000 0.000000 O
1.000000 -1.500000 0.000000 O
0.000000 -0.500000 0.000000 O
0.000000 -2.500000 -1.000000 O
1.000000 -2.500000 -1.000000 O
0.500000 -2.000000 -1.000000 O
1.500000 -2.000000 -1.000000 O
0.500000 -1.000000 -1.000000 O
0.500000 -2.000000 0.000000 O
-0.500000 -1.000000 0.000000 O
0.500000 -1.000000 0.000000 O
1.500000 -1.000000 0.000000 O
-0.500000 -2.000000 -1.000000 O
0.000000 -2.000000 -0.500000 O
1.000000 -2.000000 -0.500000 O
0.000000 -1.000000 -0.500000 O
1.000000 -1.000000 -0.500000 O
1.000000 -2.000000 0.500000 O
0.000000 -1.000000 0.500000 O
1.000000 -2.000000 -1.500000 O
0.000000 -1.000000 -1.500000 O
"""

        s = Mcsqs.structure_from_string(test_string)

        self.assertEqual(s.composition.formula, "Sr3 Ca5 Mn7 Fe1 O24")
        self.assertAlmostEqual(s.lattice.a, 2.2360679775)
        self.assertAlmostEqual(s.lattice.b, 2.2360679775)
        self.assertAlmostEqual(s.lattice.c, 1.73205080757)

    def test_mcsqs_export(self):

        s = self.get_structure('SrTiO3')
        s.replace_species({'Sr2+': {'Sr2+':0.5, 'Ca2+':0.5}})

        ref_string = """1.0 0.0 0.0
0.0 1.0 0.0
0.0 0.0 1.0
3.905000 0.000000 0.000000
-0.000000 3.905000 0.000000
0.000000 0.000000 3.905000
0.500000 0.500000 0.500000 Sr=0.5,Ca=0.5
0.000000 0.000000 0.000000 Ti=1.0
0.000000 0.000000 0.500000 O=1.0
0.000000 0.500000 0.000000 O=1.0
0.500000 0.000000 0.000000 O=1.0"""

        self.assertEqual(Mcsqs(s).to_string(), ref_string)